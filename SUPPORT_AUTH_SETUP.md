# Support System with OAuth Authentication Setup

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Google –∏–ª–∏ Apple –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∏–∫–µ—Ç—ã –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

## üöÄ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **NextAuth v5** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏:
   - Google OAuth
   - Apple Sign In

2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (`/auth/signin`):
   - –ö—Ä–∞—Å–∏–≤—ã–π UI –≤ —Å—Ç–∏–ª–µ QuailBreeder
   - –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google –∏ Apple
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

3. **–ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** (`/support`):
   - –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
   - –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ header
   - –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞

4. **API endpoint** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ (`/api/support/tickets`):
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤
   - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å email-—Å–µ—Ä–≤–∏—Å–∞–º–∏

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env.local`:

\`\`\`bash
cp .env.example .env.local
\`\`\`

### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ AUTH_SECRET

\`\`\`bash
openssl rand -base64 32
\`\`\`

–í—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `.env.local` –∫–∞–∫ `AUTH_SECRET`.

**–í–ê–ñ–ù–û:** –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ç–∞–∫–∂–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `AUTH_SECRET`!

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ Google+ API
4. –°–æ–∑–¥–∞–π—Ç–µ OAuth 2.0 Client ID:

   **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (localhost):**
   - Authorized JavaScript origins: `http://localhost:3001`
   - Authorized redirect URIs: `http://localhost:3001/api/auth/callback/google`

   **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ!):**
   - Authorized JavaScript origins: `https://quailbreeder.net`
   - Authorized redirect URIs: `https://quailbreeder.net/api/auth/callback/google`

   ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–∞ URI (localhost –∏ production) –≤ –æ–¥–∏–Ω OAuth Client ID!

5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Client Secret –≤ `.env.local` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) –∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Apple Sign In

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ [Apple Developer Program](https://developer.apple.com/programs/)
2. –°–æ–∑–¥–∞–π—Ç–µ Service ID –≤ [Apple Developer Portal](https://developer.apple.com/account/resources/identifiers/list/serviceId)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Sign In with Apple:
   - Return URLs: `http://localhost:3001/api/auth/callback/apple`
4. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ private key –∏ —Å–æ–∑–¥–∞–π—Ç–µ JWT –¥–ª—è Client Secret
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Service ID (Client ID) –∏ JWT (Client Secret) –≤ `.env.local`

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
- Return URLs: `https://quailbreeder.net/api/auth/callback/apple`

### 5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–∞—Ö, –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤:

#### Resend (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

\`\`\`bash
npm install resend
\`\`\`

–í `.env.local`:
\`\`\`
RESEND_API_KEY=your-resend-api-key
\`\`\`

–û–±–Ω–æ–≤–∏—Ç–µ `/app/api/support/tickets/route.ts`:

\`\`\`typescript
import { Resend } from 'resend'

const resend = new Resend(process.env.RESEND_API_KEY)

// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ POST:
await resend.emails.send({
  from: 'QuailBreeder Support <support@quailbreeder.net>',
  to: [process.env.SUPPORT_EMAIL!],
  subject: \`[\${priority.toUpperCase()}] \${subject}\`,
  html: \`
    <h2>New Support Ticket</h2>
    <p><strong>From:</strong> \${userEmail}</p>
    <p><strong>Category:</strong> \${category}</p>
    <p><strong>Priority:</strong> \${priority}</p>
    <p><strong>Subject:</strong> \${subject}</p>
    <hr>
    <p>\${description}</p>
  \`,
})
\`\`\`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:
\`\`\`bash
npm run dev
\`\`\`

2. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3001/auth/signin`

3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google –∏–ª–∏ Apple

4. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/support`

5. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç

6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–∞ —Ç–∏–∫–µ—Ç–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

\`\`\`
lib/
  auth.ts                              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NextAuth

app/
  api/
    auth/
      [...nextauth]/
        route.ts                        # NextAuth API route
    support/
      tickets/
        route.ts                        # API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤

  auth/
    signin/
      page.tsx                          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

  support/
    page.tsx                            # –ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

components/
  SupportTicketForm.tsx                 # –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
\`\`\`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Å—Å–∏–∏
- ‚úÖ API endpoints –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JWT –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
- ‚úÖ Redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Secure cookies –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## üöÄ Deployment

### Vercel

1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel Dashboard
2. –û–±–Ω–æ–≤–∏—Ç–µ `NEXTAUTH_URL` –Ω–∞ –≤–∞—à production URL
3. –û–±–Ω–æ–≤–∏—Ç–µ Redirect URIs –≤ Google –∏ Apple –∫–æ–Ω—Å–æ–ª—è—Ö
4. Deploy!

### –î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `NEXTAUTH_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ production URL
- OAuth redirect URIs –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

Email: support@quailbreeder.net

## üîÑ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –°—Ç–∞—Ç—É—Å—ã —Ç–∏–∫–µ—Ç–æ–≤ (–æ—Ç–∫—Ä—ã—Ç, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∑–∞–∫—Ä—ã—Ç)
- [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–∏–∫–µ—Ç—ã
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –ª–æ–≥–∏)
- [ ] –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–∞–º–∏
