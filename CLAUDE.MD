# Sidebar Hydration Flash Issue - Current Status

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–¥–≤–æ–π–Ω–∞—è –ø—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ Sidebar**:
1. –°–Ω–∞—á–∞–ª–∞ Sidebar –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ **—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º** —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (—Å —Ç–µ–∫—Å—Ç–∞–º–∏ –º–µ–Ω—é)
2. –ó–∞—Ç–µ–º **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è** –¥–æ —É–∑–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫–∏)

–≠—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π "–ø—Ä—ã–∂–æ–∫" –∏–ª–∏ "–º–µ—Ä—Ü–∞–Ω–∏–µ" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ localStorage

```javascript
localStorage.getItem('sidebar-expanded') === 'false' // Sidebar –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–µ—Ä–Ω—É—Ç
```

## –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –§–∞–π–ª—ã:
- `components/Sidebar.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Sidebar
- `contexts/SidebarContext.tsx` - React Context –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- `app/[lang]/layout.tsx` - –∫–æ—Ä–Ω–µ–≤–æ–π layout —Å inline script
- `app/[lang]/globals.css` - CSS —Å—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é

### 2. –ü–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é

**–ò–¥–µ—è:** –£–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤ Sidebar —á–µ—Ä–µ–∑ **CSS –∫–ª–∞—Å—Å—ã**, –∞ –Ω–µ —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ React.

#### –í `Sidebar.tsx`:
- ‚úÖ –í—Å–µ–≥–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏–º **–ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É DOM** (–∏–∫–æ–Ω–∫–∏ + —Ç–µ–∫—Å—Ç—ã + footer)
- ‚úÖ –£–±—Ä–∞–ª–∏ —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É `displayExpanded ? ... : ...`
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ CSS –∫–ª–∞—Å—Å** `.sidebar-collapsed`

#### –í `globals.css`:
```css
/* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç */
.sidebar-main {
  width: 14rem; /* 224px */
  overflow: hidden;
}

/* Transition —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏ */
.sidebar-hydrated .sidebar-main {
  transition: width 300ms ease-in-out;
}

/* –°–≤–µ—Ä–Ω—É—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.sidebar-collapsed .sidebar-main {
  width: 4rem !important; /* 64px */
}

/* –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç—ã –≤ —Å–≤–µ—Ä–Ω—É—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ */
.sidebar-collapsed .sidebar-label {
  display: none !important;
}

.sidebar-collapsed .sidebar-title {
  display: none !important;
}

.sidebar-collapsed .sidebar-footer {
  display: none !important;
}

/* –ò —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
```

#### –í `SidebarContext.tsx`:
```javascript
useLayoutEffect(() => {
  setIsHydrated(true)

  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º CSS –∫–ª–∞—Å—Å –ø–æ—Å–ª–µ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏
  if (isExpanded) {
    document.documentElement.classList.remove('sidebar-collapsed')
  } else {
    document.documentElement.classList.add('sidebar-collapsed')
  }

  // –í–∫–ª—é—á–∞–µ–º transitions –ü–û–°–õ–ï —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  requestAnimationFrame(() => {
    document.documentElement.classList.add('sidebar-hydrated')
  })
}, [])
```

#### –í `layout.tsx`:
```javascript
// Inline blocking script –≤ <body>
<script dangerouslySetInnerHTML={{
  __html: `
    const theme = localStorage.getItem('theme') || 'dark';
    document.documentElement.classList.add(theme);
    const sidebarExpanded = localStorage.getItem('sidebar-expanded');
    if (sidebarExpanded === 'false') {
      document.documentElement.classList.add('sidebar-collapsed');
    }
  `,
}} />
```

## –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### ‚ùå Inline script –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ React –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∏–∑ –ª–æ–≥–æ–≤:**
```
üìä HTML classes before: dark  // ‚Üê –ù–µ—Ç –∫–ª–∞—Å—Å–∞ 'sidebar-collapsed'!
```

**–û–∂–∏–¥–∞–ª–æ—Å—å:**
```
üìä HTML classes before: dark sidebar-collapsed  // ‚Üê –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å!
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è):

1. **SSR** —Ä–µ–Ω–¥–µ—Ä–∏—Ç HTML —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º Sidebar (14rem —à–∏—Ä–∏–Ω–∞)
2. **Browser** –ø–æ–ª—É—á–∞–µ—Ç HTML
3. ‚ö†Ô∏è **Inline script –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** (–∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ)
4. **React –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è** –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
5. `useLayoutEffect` –≤ SidebarContext –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Å `.sidebar-collapsed`
6. **CSS –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è** ‚Üí Sidebar —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 4rem
7. ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–π "–ø—Ä—ã–∂–æ–∫"** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–º–µ–Ω—É —à–∏—Ä–∏–Ω—ã

### –ü–æ—á–µ–º—É inline script –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**Next.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (Streaming SSR):**
- –°–∫—Ä–∏–ø—Ç—ã –≤ `<head>` –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ä—è–¥–∫–µ
- –°–∫—Ä–∏–ø—Ç—ã –≤ `<body>` –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–ø–æ—Å–ª–µ** React –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏
- Next.js –º–æ–∂–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å/–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

## –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ (—Ç–µ–∫—É—â–∏–µ)

```
üéÅ Providers RENDER, lang: undefined
üéØ Initial isExpanded from localStorage: false
üöÄ SidebarProvider MOUNTED, isExpanded: false
üìä HTML classes before: dark                        ‚Üê ‚ùå –ù–µ—Ç 'sidebar-collapsed'
‚û°Ô∏è Adding sidebar-collapsed class
üìä HTML classes after: dark sidebar-collapsed
üßπ SidebarProvider UNMOUNTING                       ‚Üê Strict Mode
üöÄ SidebarProvider MOUNTED, isExpanded: false
üìä HTML classes before: sidebar-collapsed dark      ‚Üê ‚úÖ –ö–ª–∞—Å—Å —É–∂–µ –µ—Å—Ç—å –ø–æ—Å–ª–µ 1-–≥–æ –º–æ–Ω—Ç–∞–∂–∞
‚û°Ô∏è Adding sidebar-collapsed class
üìä HTML classes after: sidebar-collapsed dark
üé® Adding sidebar-hydrated class for transitions
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: CSS-only —Ä–µ—à–µ–Ω–∏–µ (–±–µ–∑ JavaScript)

–ò–¥–µ—è: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å **—Å–≤–µ—Ä–Ω—É—Ç—ã–π** Sidebar –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ React –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è **—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç** –µ–≥–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π Sidebar ‚Üí –æ–Ω–∏ —É–≤–∏–¥—è—Ç "–ø—Ä—ã–∂–æ–∫" –≤ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cookies

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–∏—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ Cookie –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π HTML —Å—Ä–∞–∑—É.

**–ü–ª—é—Å—ã:**
- ‚úÖ SSR –∑–Ω–∞–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Sidebar
- ‚úÖ –ù–∏–∫–∞–∫–æ–≥–æ JavaScript –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ù–µ—Ç hydration mismatch

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å localStorage ‚Üî Cookie
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å Cookie

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–∏–Ω—è—Ç—å –º–µ—Ä—Ü–∞–Ω–∏–µ –∫–∞–∫ –Ω–µ–∏–∑–±–µ–∂–Ω–æ–µ

–í development mode React Strict Mode **—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ** –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–≤–∞–∂–¥—ã ‚Üí –º–µ—Ä—Ü–∞–Ω–∏–µ –Ω–µ–∏–∑–±–µ–∂–Ω–æ.

–í production —Ä–µ–∂–∏–º–µ –º–µ—Ä—Ü–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –∑–∞–º–µ—Ç–Ω–æ.

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Next.js Script component

```javascript
import Script from 'next/script'

<Script
  id="sidebar-init"
  strategy="beforeInteractive"
  dangerouslySetInnerHTML={{ __html: `...` }}
/>
```

**strategy="beforeInteractive"** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç 4** - Next.js Script —Å `beforeInteractive`
2. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç - **–≤–∞—Ä–∏–∞–Ω—Ç 2** (Cookies)
3. –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ - –æ—Ç–∫–ª—é—á–∏—Ç—å Strict Mode –≤ production
4. –ò–∑–º–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ production mode (–±–µ–∑ Strict Mode)

## –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

- `components/Sidebar.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Sidebar
- `contexts/SidebarContext.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- `app/[lang]/layout.tsx` - inline script –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è flash
- `app/[lang]/globals.css` - CSS —Å—Ç–∏–ª–∏ (—Å—Ç—Ä–æ–∫–∏ 130-222)

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
npm run dev              # Development —Å Strict Mode
npm run build && npm start  # Production —Ä–µ–∂–∏–º
```

## –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

```
–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    ‚îÇ  ‚Üê SSR: Sidebar —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç (14rem)
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    ‚îÇ     —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –º–µ–Ω—é
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì ~50-100ms
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ñà‚ñà‚ñà                 ‚îÇ  ‚Üê React: Sidebar —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è (4rem)
‚îÇ ‚ñà‚ñà‚ñà                 ‚îÇ     —Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫–∏
‚îÇ ‚ñà‚ñà‚ñà                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       FLASH! üëà –ü—Ä–æ–±–ª–µ–º–∞
```

## –ú–µ—Ç—Ä–∏–∫–∏

- **FCP (First Contentful Paint)**: ~300ms
- **–í—Ä–µ–º—è –¥–æ flash**: ~50-100ms –ø–æ—Å–ª–µ FCP
- **React Strict Mode**: –í–∫–ª—é—á–µ–Ω (–¥–≤–æ–π–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
