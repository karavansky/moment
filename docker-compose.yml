services:
  mailserver:
    image: docker.io/mailserver/docker-mailserver:latest
    container_name: mailserver
    hostname: mail
    domainname: quailbreeder.net
    env_file: .env
    ports:
      - '25:25'
      - '465:465'
      - '587:587'
      - '143:143'
      - '993:993'
    #      - "80:80"
    volumes:
      - ./docker-data/dms/mail-data/:/var/mail/
      - ./docker-data/dms/mail-state/:/var/mail-state/
      - ./docker-data/dms/config/:/tmp/docker-mailserver/
      - /etc/localtime:/etc/localtime:ro
      # –ò–∑–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
      - ./docker-data/ssl:/etc/letsencrypt:ro # Let's Encrypt –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
    #      - ./docker-data/certbot/www:/var/www/certbot:rw

    restart: always

    # üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è 2GB VPS)
    mem_limit: 900m
    cpus: 1.5

    cap_add:
      - NET_ADMIN
      - SYS_PTRACE

  blog:
    image: blog:latest
    container_name: blog
    restart: unless-stopped
    ports:
      - '3000:3000'
    environment:
      - HOSTNAME=0.0.0.0
    depends_on:
      - postgres

  moment:
    image: moment:latest
    container_name: moment
    restart: unless-stopped
    ports:
      - '3002:3002'
    environment:
      - HOSTNAME=0.0.0.0
      - SEAWEED_FILER_URL=http://seaweedfs:8888
      # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º IPv4 –¥–ª—è Node.js, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
      - NODE_OPTIONS=--dns-result-order=ipv4first
    depends_on:
      - postgres

  photon:
    image: rtuszik/photon-docker:latest
    container_name: photon
    restart: unless-stopped
    ports:
      - '2322:2322'
    environment:
      - REGION=germany # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π —Ä–µ–≥–∏–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'russia', 'france' –∏–ª–∏ 'planet')
      - UPDATE_STRATEGY=SEQUENTIAL
      - LANGUAGES=en,de,es,fr,id,ja,pt,tr,uk,it,pl,ru
    volumes:
      - ./docker-data/photon:/photon/photon_data

  seaweedfs:
    image: chrislusf/seaweedfs
    container_name: seaweedfs
    restart: unless-stopped
    ports:
      - '127.0.0.1:8333:8333'
      - '127.0.0.1:8888:8888'
      - '127.0.0.1:9333:9333'
    volumes:
      - ./docker-data/seaweedfs:/data
    command: 'server -dir=/data -s3 -filer -ip.bind=0.0.0.0'

  postgres:
    image: postgres:alpine
    container_name: alpine
    restart: unless-stopped
    ports:
      - '5432:5432'
    environment:
      - POSTGRES_USER=hronop
      - POSTGRES_PASSWORD=Sk02081978
      - PGDATA=/var/lib/postgresql/18/docker
    volumes:
      - postgres-data:/var/lib/postgresql

  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin
    restart: unless-stopped
    ports:
      - '127.0.0.1:5050:80'
    environment:
      - PGADMIN_DEFAULT_EMAIL=karavansky@gmail.com
      - PGADMIN_DEFAULT_PASSWORD=Sk02081978
      - PGADMIN_CONFIG_SERVER_MODE=True
      - PGADMIN_CONFIG_MASTER_PASSWORD_REQUIRED=False
      - PGADMIN_CONFIG_PROXY_X_FOR_COUNT=1
      - PGADMIN_CONFIG_PROXY_X_PROTO_COUNT=1
      - PGADMIN_CONFIG_PROXY_X_HOST_COUNT=1
      - SCRIPT_NAME=/pgadmin
      - PGADMIN_CONFIG_X_FRAME_OPTIONS='SAMEORIGIN'
      - PGADMIN_CONFIG_ENHANCED_COOKIE_PROTECTION=False
      - PGADMIN_CONFIG_SESSION_COOKIE_PATH='/pgadmin/'
      - PGADMIN_CONFIG_SESSION_COOKIE_NAME='pgadmin4_session'
      - PGADMIN_CONFIG_SESSION_COOKIE_SAMESITE='Lax'
      - PGADMIN_CONFIG_WTF_CSRF_TIME_LIMIT=None
    volumes:
      - pgadmin-data:/var/lib/pgadmin
    depends_on:
      - postgres

volumes:
  postgres-data:
    external: true
    name: f5b75a4d3df7bdcd9853ec8760e8d8ef8d2c3b89874cff0f8f0b4a0e767706b5
  pgadmin-data:
    external: true
    name: quailbreeder_pgadmin_data
